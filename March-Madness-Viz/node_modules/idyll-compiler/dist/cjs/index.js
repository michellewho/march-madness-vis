'use strict';

var parse = require('./parser');
var Lexer = require('./lexer');
var matter = require('gray-matter');

var cleanNewlines = function cleanNewlines(input) {
  return input.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
};

module.exports = function (input, options) {
  input = cleanNewlines(input);

  var _matter = matter(input.trim()),
      content = _matter.content,
      data = _matter.data;

  options = Object.assign({}, { spellcheck: false, smartquotes: true }, options || {});
  var lex = Lexer();
  var lexResults = lex(content);
  var output = parse(content, lexResults.tokens.join(' '), lexResults.positions, options);
  return output;
};